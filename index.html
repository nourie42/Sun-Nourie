<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Fuel Volume Estimator ‚Ä¢ Sunoco LP</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-image@latest/leaflet-image.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
  :root{
    --bg:#0f172a; --panel:#0b1224; --border:#1f2937; --muted:#94a3b8; --text:#e5e7eb;
    --accent:#60a5fa; --good:#22c55e; --warn:#f59e0b;
  }
  *{box-sizing:border-box}
  body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif; background:var(--bg); color:var(--text);}
  .brandbar{position:sticky; top:0; z-index:1000; background:linear-gradient(180deg,#0b1224,#081020); border-bottom:1px solid var(--border); padding:10px 14px; display:flex; align-items:center; justify-content:space-between;}
  .brand img{height:32px; width:auto;}
  .brand-sub{font-size:12px; color:var(--muted);}
  .container{padding:18px; max-width:780px; margin:auto;}
  h1{font-size:20px; margin:0 0 12px;}
  label{display:block; margin:12px 0 6px; color:#cbd5e1; font-size:14px;}
  input,button{width:100%; padding:12px 14px; border-radius:10px; border:1px solid var(--border); background:var(--panel); color:var(--text); font-size:16px;}
  input::placeholder{color:#64748b}
  button{background:var(--accent); color:#0b1224; font-weight:800; cursor:pointer;}
  #export{background:#34d399; display:none}
  #reset{background:#fbbf24; color:#0f172a; display:none}
  #status{margin-top:12px; font-size:14px; background:#1e293b; border:1px solid var(--border); border-radius:8px; padding:10px; height:150px; overflow-y:auto; font-family:ui-monospace,SFMono-Regular,Menlo,monospace; white-space:pre-line;}
  #result{margin-top:16px; font-size:20px; font-weight:900; color:var(--good);}
  #summary,#competitors,#developments,#insights{margin-top:10px; font-size:14px; color:#e2e8f0;}
  #map{height:58vh; margin:18px auto; border:1px solid var(--border); border-radius:12px; max-width:1200px;}
  .row{display:grid; grid-template-columns:1fr; gap:10px}
  .card{background:#0c142a; border:1px solid var(--border); border-radius:12px; padding:12px;}
  .legend{display:flex; gap:10px; align-items:center; margin-top:8px; color:#cbd5e1; font-size:12px}
  .legend .swatch{width:14px; height:14px; border-radius:999px; border:2px solid #fff; display:inline-block; margin-right:5px}
  /* Competitor star/big pins */
  .pin{display:flex; align-items:center; justify-content:center; border-radius:999px; border:2px solid #fff; box-shadow:0 2px 8px rgba(0,0,0,.45); font-weight:900; line-height:1}
  .pin.big{width:30px; height:30px; font-size:16px;}
  .pin.med{width:22px; height:22px; font-size:13px;}
  .pin.small{width:18px; height:18px; font-size:12px;}
  @media(min-width:840px){ .row{grid-template-columns:2fr 1fr} #map{height:62vh} .brand img{height:36px} }
</style>
</head>
<body>
<header class="brandbar">
  <div class="brand">
    <img src="sunoco-logo.svg" alt="Sunoco LP logo" onerror="this.style.display='none';"/>
  </div>
  <div class="brand-sub">Fuel Volume Estimator</div>
</header>

<div class="container">
  <h1>Monthly Volume Estimate</h1>

  <div class="row">
    <div class="card">
      <label for="address">Address</label>
      <input id="address" placeholder="4173 Knightdale Blvd, Knightdale, NC" />
      <label for="mpds">MPDs</label>
      <input id="mpds" type="number" min="1" value="6" />
      <label for="aadtOverride">AADT override (optional)</label>
      <input id="aadtOverride" type="number" min="1" placeholder="Enter AADT to override lookups" />
      <label for="gkey">Google API key (optional ‚Äî Street View & reviews)</label>
      <input id="gkey" placeholder="Paste restricted Google Maps key (optional)" />
      <button id="estimate">Calculate Estimate</button>
      <div id="status" aria-live="polite"></div>
      <div id="result"></div>
      <div id="summary"></div>
      <div id="insights"></div>
      <button id="export">üìÑ Export to PDF</button>
      <button id="reset">üîÑ Run Another Search</button>
    </div>

    <div class="card">
      <div class="legend">
        <span class="swatch" style="background:#ef4444"></span>Club ‚≠ê
        <span class="swatch" style="background:#f97316"></span>Hyper c-store ‚≠ê
        <span class="swatch" style="background:#fb923c"></span>Large c-store ‚≠ê
        <span class="swatch" style="background:#f59e0b"></span>Travel center ‚≠ê
        <span class="swatch" style="background:#facc15"></span>Discount
        <span class="swatch" style="background:#fcd34d"></span>Major brand
      </div>
      <div id="competitors"></div>
      <div id="developments"></div>
    </div>
  </div>
</div>

<div id="map"></div>

<script>
/* ================== Constants & conservative capacity ================== */
const CAPTURE_RATE=0.02, GALLONS_PER_STOP=9.2, DAYS_PER_MONTH=30.4;
const POSITIONS_PER_MPD=2, CYCLE_MIN=7.5, HOURS_OPEN=16, AVG_OCCUPANCY=0.12; // conservative
const COMP_QUERY_RADIUS_M=20000, HUFF_BETA=1.2; // wide area then use driving distance
const TRANS_PER_POS_PER_DAY=(60/CYCLE_MIN)*HOURS_OPEN*AVG_OCCUPANCY;    // ~15.4/day
const GPD_PER_POS=TRANS_PER_POS_PER_DAY*GALLONS_PER_STOP;               // ~141 gpd
const MONTHLY_PER_MPD_CAP=Math.min(GPD_PER_POS*POSITIONS_PER_MPD*DAYS_PER_MONTH, 8500); // ~~8.5k gal/mpd/mo cap

const fmt=n=>Number.isFinite(n)?Math.round(n).toLocaleString():"‚Äì";
const rad=d=>d*Math.PI/180;
function hav(a,b){const R=3958.8,dLat=rad(b.lat-a.lat),dLng=rad(b.lng-a.lng);
  const s=Math.sin(dLat/2)**2+Math.cos(rad(a.lat))*Math.cos(rad(b.lat))*Math.sin(dLng/2)**2;
  return 2*R*Math.asin(Math.sqrt(s));}
function clamp(x,lo,hi){return Math.max(lo,Math.min(hi,x));}

/* ================== Map ================== */
const map=L.map('map').setView([35.7796,-78.6382],11);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,crossOrigin:true}).addTo(map);
let siteMarker=null, compLayer=null, devLayer=null, radiusCircle=null;

/* ================== Logger ================== */
function logger(el){el.textContent="";return(msg,ok=false)=>{el.textContent+=(ok?"‚úÖ ":"‚è≥ ")+msg+"\n";el.scrollTop=el.scrollHeight;}}

/* ================== Overpass with fallback ================== */
const OVERPASS=["https://overpass-api.de/api/interpreter","https://overpass.kumi.systems/api/interpreter"];
async function overpassQuery(q){
  for(const ep of OVERPASS){
    try{
      const r=await fetch(ep,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:"data="+encodeURIComponent(q)});
      if(r.ok) return await r.json();
    }catch(e){}
  }
  throw new Error("Overpass unavailable");
}

/* ================== OSRM driving distance ================== */
async function driveMiles(a,b){
  try{
    const url=`https://router.project-osrm.org/route/v1/driving/${a.lng},${a.lat};${b.lng},${b.lat}?overview=false&alternatives=false`;
    const r=await fetch(url);
    const j=await r.json();
    const m=j.routes?.[0]?.distance; // meters
    return m ? m/1609.344 : hav(a,b); // fallback to straight-line
  }catch(e){ return hav(a,b); }
}

/* ================== AADT lookups (never default) ================== */
// ArcGIS generic query
async function queryArcGISAADT(url, lat, lng, distanceMeters){
  const params = {
    where:"1=1", geometry:`${lng},${lat}`, geometryType:"esriGeometryPoint", inSR:"4326",
    spatialRel:"esriSpatialRelIntersects", distance:String(distanceMeters), units:"esriSRUnit_Meter",
    outFields:"*", outSR:"4326", f:"json"
  };
  const res = await fetch(url + "?" + new URLSearchParams(params));
  if(!res.ok) return null;
  const j = await res.json();
  if(!j.features?.length) return null;
  // choose nearest
  let best=null, bestD=1e9;
  for(const f of j.features){
    const p={lat:f.geometry.y, lng:f.geometry.x};
    const d=hav({lat,lng},{lat:p.lat,lng:p.lng});
    if(d<bestD){bestD=d; best=f;}
  }
  // try common AADT field names
  const a = best.attributes||{};
  const val = [a.AADT, a.Avg_Daily_Traffic, a.aadt, a.TrafficCount, a.AADT2019, a.AADTYEAR, a.AADT_2020]
    .find(v=>typeof v==="number" && v>0) || null;
  if(!val) return null;
  const htmlLink = url + "?" + new URLSearchParams({...params, f:"html"});
  return {value:val, miles:bestD, link:htmlLink};
}
// NC DOT specific
const NC_AADT = "https://services.arcgis.com/NuWFvHYDMVmmxMeM/ArcGIS/rest/services/NCDOT_AADT_Stations/FeatureServer/0/query";
// USA Traffic Counts (Living Atlas)
const USA_AADT = "https://services.arcgis.com/P3ePLMYs2RVChkJx/ArcGIS/rest/services/USA_Traffic_Counts/FeatureServer/0/query";

async function robustAADT(lat,lng, state){
  // try NC-specific
  if((state||"").toLowerCase().includes("north carolina")){
    for(const d of [500,1000,2000,3000,5000,10000,15000]){
      const hit = await queryArcGISAADT(NC_AADT, lat, lng, d);
      if(hit) return {source:"NCDOT", ...hit};
    }
  }
  // then national USA layer
  for(const d of [500,1000,2000,3000,5000,10000,15000]){
    const hit = await queryArcGISAADT(USA_AADT, lat, lng, d);
    if(hit) return {source:"Esri USA Traffic Counts", ...hit};
  }
  return null; // never default
}

/* ================== Brand rules & icons ================== */
const BRAND_RULES=[
  {re:/\b(costco|sam'?s club|bj'?s)\b/i,cat:"club",w:2.5,mpd:8,color:"#ef4444",penalties:[{mi:1.5,p:0.25},{mi:3.1,p:0.15}],star:true,size:"big"},
  {re:/\b(buc-?ee?s?)\b/i,cat:"hyper_cstore",w:3.0,mpd:20,color:"#f97316",penalties:[{mi:5,p:0.25}],star:true,size:"big"},
  {re:/\b(wawa|sheetz|quik\s?trip|^qt\b|qt\s|racetrac|race\s?trac|getgo|casey'?s)\b/i,cat:"large_cstore",w:2.0,mpd:6,color:"#fb923c",penalties:[{mi:1.5,p:0.10},{mi:3.1,p:0.06}],star:true,size:"med"},
  {re:/\b(love'?s|pilot|flying\s?j|ta|petro)\b/i,cat:"travel_center",w:2.0,mpd:10,color:"#f59e0b",penalties:[{mi:2.5,p:0.10}],star:true,size:"med"},
  {re:/\b(murphy|speedway)\b/i,cat:"discount",w:1.5,mpd:6,color:"#facc15",penalties:[{mi:2.5,p:0.06}],star:false,size:"med"},
  {re:/\b(circle\s?k|7-?eleven|7 eleven|exxon|mobil|bp|chevron|shell|sunoco|valero|phillips|76|citgo)\b/i,cat:"major_brand",w:1.3,mpd:6,color:"#fcd34d",penalties:[{mi:2.0,p:0.04}],star:false,size:"med"},
  {re:/./,cat:"other",w:1.0,mpd:4,color:"#fbbf24",penalties:[],star:false,size:"small"}
];
function classifyBrand(name){
  const s=(name||"").toString();
  return BRAND_RULES.find(r=>r.re.test(s))||BRAND_RULES[BRAND_RULES.length-1];
}
function compIcon(rule){
  const sizeClass=rule.size||"med";
  const star = rule.star ? "‚òÖ" : "";
  return L.divIcon({className:"div-pin", html:`<div class="pin ${sizeClass}" style="background:${rule.color}">${star}</div>`, iconSize:null, iconAnchor:[15,15]});
}

/* ================== Competitors & Developments ================== */
async function fetchCompetitors(lat,lng){
  // wide query area; we‚Äôll rank by driving distance later
  const q=`[out:json][timeout:25];
    (node["amenity"="fuel"](around:${COMP_QUERY_RADIUS_M},${lat},${lng});
     way["amenity"="fuel"](around:${COMP_QUERY_RADIUS_M},${lat},${lng});
     relation["amenity"="fuel"](around:${COMP_QUERY_RADIUS_M},${lat},${lng});); out center tags;`;
  const j=await overpassQuery(q);
  const rows=(j.elements||[]).map(e=>{
    const c=e.type==="node"?{lat:e.lat,lng:e.lon}:(e.center||null); if(!c) return null;
    const name=e.tags?.brand||e.tags?.name||"Fuel station";
    const pumps=parseInt(e.tags?.pumps);
    const brand=classifyBrand(name);
    const mpdGuess=Number.isFinite(pumps)?Math.max(1,Math.round(pumps/2)):brand.mpd;
    const attr=brand.w*mpdGuess;
    return {lat:c.lat,lng:c.lon,name,brand,mpdGuess,attr};
  }).filter(Boolean);

  // driving distance for top N by crow distance first to reduce OSRM calls
  const sorted = rows.map(r=>({...r, crow: hav({lat,lng},{lat:r.lat,lng:r.lng})}))
                     .sort((a,b)=>a.crow-b.crow).slice(0,40);
  for(let i=0;i<sorted.length;i++){
    sorted[i].drive = await driveMiles({lat,lng},{lat:sorted[i].lat,lng:sorted[i].lng});
  }
  return sorted.sort((a,b)=>a.drive-b.drive);
}
async function fetchDevelopments(lat,lng){
  const q=`[out:json][timeout:25];
    (node["amenity"="fuel"]["proposed"](around:${COMP_QUERY_RADIUS_M},${lat},${lng});
     way["amenity"="fuel"]["proposed"](around:${COMP_QUERY_RADIUS_M},${lat},${lng});
     relation["amenity"="fuel"]["proposed"](around:${COMP_QUERY_RADIUS_M},${lat},${lng});
     node["amenity"="fuel"]["construction"](around:${COMP_QUERY_RADIUS_M},${lat},${lng});
     way["amenity"="fuel"]["construction"](around:${COMP_QUERY_RADIUS_M},${lat},${lng});
     relation["amenity"="fuel"]["construction"](around:${COMP_QUERY_RADIUS_M},${lat},${lng});); out center tags;`;
  const j=await overpassQuery(q);
  return (j.elements||[]).map(e=>{
    const c=e.type==="node"?{lat:e.lat,lng:e.lon}:(e.center||null); if(!c) return null;
    const name=e.tags?.brand||e.tags?.name||"New fuel development";
    const stage=e.tags?.proposed?"proposed":(e.tags?.construction?"construction":"planned");
    const dist=hav({lat,lng},{lat:c.lat,lng:c.lon});
    return {lat:c.lat,lng:c.lon,name,stage,dist};
  }).filter(Boolean).sort((a,b)=>a.dist-b.dist);
}

/* ================== Demand, capacity, penalties ================== */
function siteAttrFromMPDs(mpds){return Math.max(1,mpds);}
function huffShare(siteAttr, comps, beta=HUFF_BETA){
  const eps=0.1, siteD=0.1;
  let denom=siteAttr/Math.pow(siteD,beta);
  comps.forEach(c=>denom+=c.attr/Math.pow(Math.max(eps,c.drive||c.crow||1),beta));
  return Math.max(0, Math.min(1, (siteAttr/Math.pow(siteD,beta))/denom ));
}
function demandGallons(aadt,share){return aadt*CAPTURE_RATE*GALLONS_PER_STOP*DAYS_PER_MONTH*share;}
function capacityCapGallons(mpds){return mpds*MONTHLY_PER_MPD_CAP;}
function applyBlockingWhenOverloaded(gal,cap){
  if(gal<=cap) return {g:gal, penaltyPct:0};
  const overload=gal/cap, penalty=Math.max(0.8, 1-0.25*(overload-1)); // up to 20% cut
  return {g:cap*penalty, penaltyPct:Math.round((1-penalty)*100)};
}
function competitivePenalties(comps){
  const items=[];
  comps.forEach(c=>{
    for(const r of c.brand.penalties){ if((c.drive||c.crow)<=r.mi){ items.push({name:c.name,dist:c.drive||c.crow,pct:Math.round(r.p*100)}); break; } }
  });
  let factor=1.0; items.forEach(x=>factor*=(1-x.pct/100));
  return {items,factor};
}

/* ================== Main ================== */
document.getElementById('estimate').onclick=async()=>{
  const status=document.getElementById('status'); const log=logger(status);
  const result=document.getElementById('result'); const summary=document.getElementById('summary'); const insights=document.getElementById('insights');
  const compDiv=document.getElementById('competitors'); const devDiv=document.getElementById('developments');
  const exportBtn=document.getElementById('export'); const resetBtn=document.getElementById('reset');

  result.textContent=""; summary.textContent=""; insights.textContent=""; compDiv.textContent=""; devDiv.textContent="";
  exportBtn.style.display="none"; resetBtn.style.display="none";
  if(compLayer){map.removeLayer(compLayer); compLayer=null;}
  if(devLayer){map.removeLayer(devLayer); devLayer=null;}
  if(radiusCircle){map.removeLayer(radiusCircle); radiusCircle=null;}

  try{
    const addr=document.getElementById('address').value.trim();
    const mpds=Math.max(1,parseInt(document.getElementById('mpds').value)||6);
    const aadtOverride=parseInt(document.getElementById('aadtOverride').value)||null;
    if(!addr) throw new Error("Please enter an address.");

    log("Geocoding address‚Ä¶");
    const g=await fetch(`https://nominatim.openstreetmap.org/search?format=json&addressdetails=1&limit=1&q=${encodeURIComponent(addr)}`);
    const gj=await g.json(); if(!gj.length) throw new Error("Address not found.");
    const lat=+gj[0].lat, lng=+gj[0].lon;
    const state = gj[0].address?.state || "";
    log(`Found location at (${lat.toFixed(4)}, ${lng.toFixed(4)})`,true);

    if(siteMarker) map.removeLayer(siteMarker);
    siteMarker=L.marker([lat,lng]).addTo(map).bindPopup("Your site").openPopup();
    map.setView([lat,lng],13);

    // AADT: override or robust lookup (no default)
    let aadt=null, aadtSource="", aadtMiles=0, aadtLink="";
    if(aadtOverride){ aadt=aadtOverride; aadtSource="User override"; }
    else{
      log("Finding AADT (DOT/ArcGIS)‚Ä¶");
      const hit=await robustAADT(lat,lng,state);
      if(hit){ aadt=hit.value; aadtSource=hit.source; aadtMiles=hit.miles; aadtLink=hit.link; log(`AADT ${fmt(aadt)} from ${aadtSource} (${aadtMiles.toFixed(2)} mi)`,true); }
      else { throw new Error("Could not find AADT nearby. Please enter an AADT override."); }
    }

    // Competitors by driving distance
    log("Searching competitors (wide area) ‚Ä¶");
    let comps=await fetchCompetitors(lat,lng);
    log(`Computed driving distances for ${comps.length} stations.`,true);
    if(compLayer) map.removeLayer(compLayer);
    compLayer=L.layerGroup(comps.map(c=>{
      const ic=compIcon(c.brand);
      return L.marker([c.lat,c.lng],{icon:ic}).bindPopup(`${c.name}<br>${c.brand.cat.replace("_"," ")}<br>${(c.drive||0).toFixed(1)} mi drive`);
    })).addTo(map);

    // Developments (by crow distance just for heads-up)
    log("Checking new developments (proposed/construction)‚Ä¶");
    const devs=await fetchDevelopments(lat,lng);

    // Demand share & penalties using driving distance
    log("Allocating demand (brand-weighted, driving distance)‚Ä¶");
    const siteAttr=siteAttrFromMPDs(mpds);
    const share=huffShare(siteAttr, comps, HUFF_BETA);
    const {items:penItems,factor:penFactor}=competitivePenalties(comps);

    // Estimate with conservative capacity
    const demand=demandGallons(aadt,share)*penFactor;
    const capacity=capacityCapGallons(mpds);
    const capped=applyBlockingWhenOverloaded(demand,capacity);

    result.textContent=`Estimated Monthly Gallons: ${fmt(capped.g)}`;

    const adjBits=[];
    if(penItems.length){ adjBits.push(penItems.slice(0,5).map(x=>`${x.name} ${(x.dist).toFixed(1)} mi (‚àí${x.pct}%)`).join("; ")); }
    if(capped.penaltyPct>0) adjBits.push(`capacity/queuing penalty ‚àí${capped.penaltyPct}%`);

    summary.innerHTML =
      `AADT <b>${fmt(aadt)}</b> (${aadtSource}${aadtLink?`, <a href="${aadtLink}" target="_blank" rel="noopener">ArcGIS record</a>`:""}${aadtMiles?`, ${aadtMiles.toFixed(2)} mi`:""}) ¬∑ MPDs ${mpds}` +
      ` ¬∑ competitors ${comps.length} (driving distance)` +
      ` ¬∑ developments ${devs.length}` +
      (adjBits.length?` ¬∑ <b>Competitive adjustments:</b> ${adjBits.join(" ¬∑ ")}`:"");

    // Lists
    if(comps.length){
      let list="<b>Top competitors by drive distance:</b><ul>";
      comps.slice(0,8).forEach(c=>list+=`<li>${c.name} ‚Äî ${c.brand.cat.replace("_"," ")} ‚Äî ${(c.drive||0).toFixed(1)} mi</li>`);
      list+="</ul>"; compDiv.innerHTML=list;
    }
    if(devs.length){
      let dl="<b>New developments (heads-up):</b><ul>";
      devs.slice(0,8).forEach(d=>dl+=`<li>${d.name} ‚Äî ${d.stage} ‚Äî ${d.dist.toFixed(1)} mi</li>`);
      dl+="</ul>"; devDiv.innerHTML=dl;
    }

    // Export to PDF with real map (leaflet-image)
    exportBtn.style.display="block"; resetBtn.style.display="block";
    exportBtn.onclick=()=>{
      const { jsPDF } = window.jspdf;
      leafletImage(map, (err, canvas)=>{
        const doc=new jsPDF({unit:"pt", format:"a4"});
        doc.setFontSize(14);
        doc.text("Fuel Volume Estimate", 40, 40);
        doc.setFontSize(11);
        doc.text(`Address: ${addr}`, 40, 60);
        doc.text(`MPDs: ${mpds}`, 40, 76);
        doc.text(`AADT: ${fmt(aadt)} (${aadtSource})`, 40, 92);
        if(aadtLink) doc.textWithLink("Open AADT ArcGIS record", 40, 108, {url:aadtLink});
        doc.text(result.textContent, 40, 130);
        const img = canvas.toDataURL("image/png");
        doc.addImage(img, "PNG", 40, 150, 515, 300);
        doc.save("fuel_estimate.pdf");
      });
    };

    // Reset
    resetBtn.onclick=()=>{
      document.getElementById('address').value="";
      document.getElementById('mpds').value="6";
      document.getElementById('aadtOverride').value="";
      status.textContent=""; result.textContent=""; summary.textContent=""; insights.textContent="";
      compDiv.textContent=""; devDiv.textContent="";
      exportBtn.style.display="none"; resetBtn.style.display="none";
      if(siteMarker){map.removeLayer(siteMarker); siteMarker=null;}
      if(compLayer){map.removeLayer(compLayer); compLayer=null;}
      if(devLayer){map.removeLayer(devLayer); devLayer=null;}
      if(radiusCircle){map.removeLayer(radiusCircle); radiusCircle=null;}
      map.setView([35.7796,-78.6382],11);
      document.getElementById('address').focus();
    };

    log("‚ö° Estimate complete!", true);
    status.textContent += "\n‚ùì Do you want me to run another search?\n";

  }catch(e){
    status.textContent += "‚ùå " + e.message + "\n";
  }
};

// Enter to run
document.getElementById('address').addEventListener('keydown',e=>{ if(e.key==="Enter"){ document.getElementById('estimate').click(); }});
</script>
</body>
</html>
