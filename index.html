<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Monthly Fuel Volume Estimator</title>
<link rel="preconnect" href="https://unpkg.com" crossorigin>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
:root {
  --bg:#0f172a; --card:#111827; --muted:#94a3b8; --text:#e5e7eb; --accent:#60a5fa; --good:#22c55e; --warn:#f59e0b; --bad:#ef4444;
  --border:#1f2937;
}
html,body {height:100%; margin:0; background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;}
.app {display:grid; grid-template-columns: 420px 1fr; height:100%;}
.panel {padding:18px 18px 120px; overflow:auto; border-right:1px solid var(--border); background:linear-gradient(180deg,#0f172a 0%, #0b1224 100%);}
h1 {font-size:20px; margin:0 0 12px; font-weight:700;}
h2 {font-size:15px; margin:18px 0 8px; color:var(--muted); font-weight:600; letter-spacing:.2px;}
label {display:block; font-size:13px; color:#cbd5e1; margin:10px 0 6px;}
input, select, button {
  width:100%; box-sizing:border-box; border:1px solid var(--border); background:#0b1224; color:#e5e7eb;
  padding:12px 14px; border-radius:10px; font-size:16px; outline:none;
}
input::placeholder {color:#64748b;}
.grid {display:grid; grid-template-columns:1fr 1fr; gap:10px;}
.btn {background:var(--accent); color:#0b1224; font-weight:700; cursor:pointer; border:none;}
.btn:disabled {opacity:.5; cursor:not-allowed;}
.muted {color:var(--muted);}
.map {height:100%; width:100%;}
.kpi {display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; margin:14px 0;}
.kcard {background:#0b1224; border:1px solid var(--border); border-radius:12px; padding:12px;}
.kval {font-size:20px; font-weight:800;}
.kcap {font-size:12px; color:var(--muted); margin-top:4px;}
.card {background:#0b1224; border:1px solid var(--border); border-radius:14px; padding:14px; margin:12px 0;}
.small {font-size:12px; line-height:1.4;}
.foot {position:fixed; bottom:0; left:0; right:0; background:rgba(15,23,42,.9); backdrop-filter: blur(8px);
       border-top:1px solid var(--border); padding:10px 14px; font-size:12px;}

/* ðŸ“± Mobile responsive */
@media (max-width: 768px) {
  .app {grid-template-columns: 1fr; grid-template-rows: auto 1fr;}
  .panel {border-right:none; border-bottom:1px solid var(--border); height:auto; padding-bottom:80px;}
  .map {height:60vh;}
  .grid {grid-template-columns:1fr;}
  h1 {font-size:18px;}
  input, select, button {font-size:16px; padding:14px;}
  .kpi {grid-template-columns:1fr;}
}
</style>
</head>
<body>
<div class="app">
  <div class="panel">
    <h1>Monthly Fuel Volume Estimator</h1>
    <div class="small muted">Click the map to set a site pin (or paste lat,lng). Then enter MPDs and hit Estimate.</div>

    <h2>Site</h2>
    <label>Search address (optional)</label>
    <div class="row">
      <input id="search" placeholder="123 Main St, Knightdale, NC" />
      <button class="btn" id="geocode">Find</button>
    </div>

    <div class="grid">
      <div>
        <label>Latitude</label>
        <input id="lat" placeholder="35.787..." />
      </div>
      <div>
        <label>Longitude</label>
        <input id="lng" placeholder="-78.632..." />
      </div>
    </div>

    <div class="grid">
      <div>
        <label>MPDs (multi-product dispensers)</label>
        <input id="mpds" type="number" min="1" step="1" value="6" />
      </div>
      <div>
        <label>Competition radius (miles)</label>
        <input id="radius" type="number" min="0.5" step="0.1" value="3.0" />
      </div>
    </div>

    <h2>Traffic assumptions</h2>
    <div class="grid">
      <div>
        <label>Capture rate (default 2%)</label>
        <input id="capture" type="number" step="0.001" value="0.02" />
      </div>
      <div>
        <label>Gallons per stop (default 8)</label>
        <input id="gallonsPerStop" type="number" step="0.1" value="8" />
      </div>
    </div>
    <div class="grid">
      <div>
        <label>Days per month</label>
        <input id="dpm" type="number" value="30.4" />
      </div>
      <div>
        <label>Distance-decay Î²</label>
        <input id="beta" type="number" step="0.1" value="1.2" />
      </div>
    </div>

    <h2>AADT source</h2>
    <div class="card small">
      <div><b>NCDOT AADT FeatureService (default)</b></div>
      <input id="aadtUrl" placeholder="ArcGIS FeatureServer .../FeatureServer/0" />
    </div>

    <h2>Reviews (optional)</h2>
    <label>Google Maps API key</label>
    <input id="gkey" placeholder="AIza..." />

    <h2>Run</h2>
    <button class="btn" id="estimate">Estimate monthly gallons</button>
    <div class="foot tiny">Data: NACS, DOT AADT, OSM, OSRM, Google Places.</div>
  </div>
  <div id="map" class="map"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// ===== Utilities
const fmt={int:n=>Number.isFinite(n)?Math.round(n).toLocaleString():"â€“"};
function toMiles(m){return m/1609.344;}
function toMeters(mi){return mi*1609.344;}
function rad(d){return d*Math.PI/180;}
function hav(a,b){const R=3958.8;const dLat=rad(b.lat-a.lat);const dLng=rad(b.lng-a.lng);
const s=Math.sin(dLat/2)**2+Math.cos(rad(a.lat))*Math.cos(rad(b.lat))*Math.sin(dLng/2)**2;
return 2*R*Math.asin(Math.sqrt(s));}

// ===== Map
const map=L.map('map').setView([35.7796,-78.6382],11);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);
let pin=L.marker([35.7796,-78.6382],{draggable:true}).addTo(map);
pin.on('move',e=>{document.getElementById('lat').value=e.latlng.lat.toFixed(6);document.getElementById('lng').value=e.latlng.lng.toFixed(6);});
map.on('click',e=>{pin.setLatLng(e.latlng);map.panTo(e.latlng);document.getElementById('lat').value=e.latlng.lat.toFixed(6);document.getElementById('lng').value=e.latlng.lng.toFixed(6);});

// ===== Estimate (simplified demo)
document.getElementById('estimate').onclick=()=>{
  const aadt=20000; // placeholder, would fetch real DOT AADT
  const capture=+document.getElementById('capture').value;
  const gps=+document.getElementById('gallonsPerStop').value;
  const dpm=+document.getElementById('dpm').value;
  const base=aadt*capture*gps*dpm;
  alert(`AADT: ${aadt}\nEstimated Monthly Gallons: ${fmt.int(base)}`);
};
</script>
</body>
</html>
