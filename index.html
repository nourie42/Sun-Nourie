<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Fuel Volume Estimator â€¢ Sunoco LP</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-image@latest/leaflet-image.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
  :root{
    --bg:#0f172a; --panel:#0b1224; --border:#1f2937; --muted:#94a3b8; --text:#e5e7eb;
    --accent:#60a5fa; --good:#22c55e; --warn:#fbbf24;
  }
  *{box-sizing:border-box}
  body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif; background:var(--bg); color:var(--text);}
  header{position:sticky; top:0; z-index:10; display:flex; justify-content:space-between; align-items:center; padding:10px 14px; background:linear-gradient(180deg,#0b1224,#081020); border-bottom:1px solid var(--border);}
  header img{height:32px; width:auto;}
  .container{max-width:880px; margin:auto; padding:16px;}
  h1{margin:0 0 12px; font-size:20px;}
  label{margin-top:12px; display:block; font-size:14px; color:#cbd5e1;}
  input,button{width:100%; padding:12px 14px; border-radius:10px; border:1px solid var(--border); background:var(--panel); color:var(--text); font-size:16px;}
  button{background:var(--accent); color:#0b1224; font-weight:800; cursor:pointer;}
  #status{margin-top:12px; font:13px/1.45 ui-monospace,SFMono-Regular,Menlo,Consolas,monospace; background:#1e293b; border:1px solid var(--border); border-radius:8px; padding:10px; height:150px; overflow:auto; white-space:pre-line;}
  #result{margin-top:14px; font-size:20px; font-weight:900; color:var(--good);}
  #summary,#competitors,#developments,#reviewsBox{margin-top:10px; font-size:14px;}
  #map{height:62vh; margin-top:16px; border:1px solid var(--border); border-radius:12px;}
  .small{font-size:12px; color:#94a3b8; margin-top:6px;}
</style>
</head>
<body>
<header>
  <img src="sunoco-logo.svg" alt="Sunoco LP logo" onerror="this.style.display='none'">
  <div>Fuel Volume Estimator</div>
</header>

<div class="container">
  <h1>Monthly Volume Estimate</h1>

  <label>Address</label>
  <input id="address" placeholder="4173 Knightdale Blvd, Knightdale, NC" />

  <label>MPDs</label>
  <input id="mpds" type="number" min="1" value="6" />

  <label>AADT override (optional)</label>
  <input id="aadtOverride" type="number" min="1" placeholder="Enter DOT AADT manually if known" />

  <button id="estimate">Calculate Estimate</button>

  <div id="status" aria-live="polite">Waitingâ€¦</div>
  <div id="result"></div>
  <div id="summary"></div>
  <div id="reviewsBox"></div>
  <div id="competitors"></div>
  <div id="developments"></div>

  <button id="export" style="display:none">ðŸ“„ Export to PDF</button>
</div>

<div id="map" role="region" aria-label="Map"></div>

<script>
/* ================== Hard-coded Google API key ================== */
const gkey = "YOUR_GOOGLE_API_KEY_HERE";  // <--- replace this with your key

/* ================== Example Google usage ================== */
function streetViewURL(lat,lng){
  const base="https://maps.googleapis.com/maps/api/streetview";
  const p=new URLSearchParams({size:"640x360",location:`${lat},${lng}`,key:gkey});
  return `${base}?${p.toString()}`;
}
async function fetchPlaceDetails(lat,lng){
  if(!gkey) return null;
  const svc=new google.maps.places.PlacesService(document.createElement('div'));
  const nearby=await new Promise(res=>svc.nearbySearch({location:{lat,lng},radius:120,type:['gas_station']},(r,st)=>res(st==='OK'?r:[])));
  if(!nearby.length) return null;
  const best=nearby[0];
  return await new Promise(res=>svc.getDetails({placeId:best.place_id,fields:['name','rating','user_ratings_total','reviews']},(r,st)=>res(st==='OK'?r:null)));
}

/* ================== Main Click ================== */
document.getElementById('estimate').onclick = async () => {
  const status=document.getElementById('status'); status.textContent="Calculatingâ€¦\n";
  const reviewsBox=document.getElementById('reviewsBox'); reviewsBox.textContent="";
  try {
    const addr=document.getElementById('address').value.trim();
    if(!addr) throw new Error("Enter an address first.");
    status.textContent+="Looking up reviewsâ€¦\n";
    if(gkey){
      const details = await fetchPlaceDetails(35.79,-78.62); // sample coords; youâ€™d use geocode results here
      if(details){
        reviewsBox.innerHTML = `<b>${details.name}</b> â€” â˜…${details.rating||"â€“"} (${details.user_ratings_total||0})<br>`+
          (details.reviews||[]).slice(0,3).map(r=>`<p>${r.text}</p>`).join("");
      } else {
        reviewsBox.innerHTML = "No reviews found automatically.<br>"+
          `<a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(addr)}" target="_blank">Search Google Maps</a>`;
      }
    } else {
      reviewsBox.innerHTML = "Google API key not provided. Cannot fetch reviews.<br>"+
        `<a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(addr)}" target="_blank">Search Google Maps</a>`;
    }
  } catch(e){
    status.textContent+="Error: "+e.message;
  }
};
</script>
</body>
</html>
