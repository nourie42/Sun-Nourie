<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ü§ñ AI-Powered Job Match Portal</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family:'Inter',sans-serif; background: linear-gradient(135deg,#667eea 0%,#764ba2 100%); }
    .glass { background:rgba(255,255,255,.9); backdrop-filter:blur(10px); border-radius:1rem; padding:1.5rem; }
    .card { box-shadow:0 10px 25px rgba(0,0,0,0.15); margin-bottom:1.5rem; }
    .spinner { width:18px; height:18px; border:3px solid #ddd; border-top:3px solid #6366f1; border-radius:50%; animation:spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .progress { height:6px; background:#e2e8f0; border-radius:4px; overflow:hidden; }
    #progressBar { height:6px; width:0; background:#6366f1; transition:width .3s; }
  </style>
</head>
<body class="p-4 md:p-10">
  <h1 class="text-3xl font-bold text-white mb-6">ü§ñ AI-Powered Job Match Portal</h1>
  <p class="text-white mb-6">AI matches your resume to jobs and fetches <b>real postings</b>.</p>

  <!-- Mode + API Key -->
  <section class="glass card">
    <h2 class="text-lg font-semibold text-slate-800 mb-3">‚öôÔ∏è Mode & API Key</h2>
    <div class="flex gap-6">
      <label class="flex items-center gap-2"><input id="modeBackend" type="radio" name="mode" checked> Backend</label>
      <label class="flex items-center gap-2"><input id="modeAI" type="radio" name="mode"> OpenAI</label>
    </div>
    <input id="apiKey" type="password" class="mt-3 w-full rounded-lg border border-slate-200 px-3 py-2" placeholder="sk-..." />
  </section>

  <!-- Profile -->
  <section class="glass card">
    <h2 class="text-lg font-semibold text-slate-800 mb-3">üìã Your Resume Profile</h2>
    <textarea id="resumeText" class="w-full rounded-lg border border-slate-200 px-3 py-2" rows="6">Paste resume text here...</textarea>
    <div class="flex items-end gap-2 mt-4">
      <button id="btnSearch" class="px-5 py-3 rounded-xl bg-indigo-600 text-white font-semibold">üîç Search</button>
      <div id="busy" class="hidden items-center gap-3"><div class="spinner"></div><span>Working‚Ä¶</span></div>
    </div>
    <p id="err" class="mt-3 hidden text-sm text-red-600"></p>
  </section>

  <!-- Results -->
  <section id="results" class="glass card hidden">
    <div class="flex items-center justify-between mb-4">
      <div id="resultCount" class="font-semibold">0 results</div>
    </div>
    <div id="grid" class="grid gap-4"></div>
    <div id="empty" class="hidden text-center text-slate-500 py-10">No results found.</div>
  </section>

<script>
const btnSearch=document.getElementById("btnSearch"),busy=document.getElementById("busy"),err=document.getElementById("err"),results=document.getElementById("results"),grid=document.getElementById("grid"),resultCount=document.getElementById("resultCount"),empty=document.getElementById("empty"),apiKeyInput=document.getElementById("apiKey"),modeBackend=document.getElementById("modeBackend"),modeAI=document.getElementById("modeAI");

apiKeyInput.value=localStorage.getItem("openai_api_key")||"";apiKeyInput.addEventListener("input",()=>localStorage.setItem("openai_api_key",apiKeyInput.value));

function cleanJSON(s){s=s.trim().replace(/^```json/i,"").replace(/```$/i,"").trim();try{return JSON.parse(s)}catch{const m=s.match(/({[\\s\\S]*}|\\[[\\s\\S]*\\])/);if(m)return JSON.parse(m[1]);throw new Error("Invalid JSON from AI")}}

function renderJobs(list){grid.innerHTML="";list.forEach(j=>{const c=document.createElement("div");c.className="p-4 border rounded-xl bg-white";c.innerHTML=`<h4 class="font-semibold">${j.title}</h4><p>${j.company}</p><p>${j.location||"Remote"}</p>${j.link?`<a href="${j.link}" target="_blank" class="text-indigo-600 underline">View</a>`:""}<p>Match: ${j.match??"-"}%</p>`;grid.appendChild(c)});results.classList.remove("hidden");resultCount.textContent=`${list.length} jobs found`}

function renderEstimate(e){grid.innerHTML="";const est=e.estimate||e;const c=document.createElement("div");c.className="p-4 border rounded-xl bg-white";c.innerHTML=`<h4>Estimate Result</h4><p>Low: ${est.low}</p><p>Range: ${est.range}</p><p>Year2: ${est.year2}</p><p>Year3: ${est.year3}</p>`;grid.appendChild(c);results.classList.remove("hidden");resultCount.textContent="1 estimate"}

btnSearch.onclick=async()=>{err.classList.add("hidden");busy.classList.remove("hidden");try{const resume=document.getElementById("resumeText").value;let jobs=null;if(modeBackend.checked){const r=await fetch("/estimate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({address:"Knightdale, NC",mpds:4,diesel:0})});if(r.ok)jobs=await r.json();if(jobs?.estimate)renderEstimate(jobs)}else if(modeAI.checked){const key=apiKeyInput.value.trim();if(!key)throw new Error("Enter OpenAI key");const r=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${key}`},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"system",content:"Return JSON: [{title,company,location,link,match}]"}, {role:"user",content:`Find jobs for ${resume}`}]})});const j=await r.json();jobs=cleanJSON(j.choices?.[0]?.message?.content||"");if(Array.isArray(jobs))renderJobs(jobs);else if(jobs.jobs)renderJobs(jobs.jobs)}else throw new Error("No mode selected")}catch(e){err.textContent=e.message;err.classList.remove("hidden")}finally{busy.classList.add("hidden")}};
</script>
</body>
</html>
