<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI-Powered Job Match Portal</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --brand:#667eea; --brand2:#764ba2; }
    html,body { height:100%; }
    body { font-family:'Inter', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .glass { background: rgba(255,255,255,.85); backdrop-filter: blur(10px); }
    .chip { @apply px-4 py-2 rounded-full border border-slate-200 bg-white text-sm font-medium cursor-pointer; }
    .chip.active { background: linear-gradient(135deg, var(--brand), var(--brand2)); color:#fff; border-color:transparent; }
    .card { @apply glass rounded-2xl shadow-2xl p-6; }
    .badge { @apply inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold; }
    .score { @apply absolute top-4 right-4 w-16 h-16 rounded-full text-white font-bold flex items-center justify-center shadow-lg; }
    .score.excellent { background: linear-gradient(135deg, #00ff88, #00d084); }
    .score.good { background: linear-gradient(135deg, #3b82f6, #2563eb); }
    .score.fair { background: linear-gradient(135deg, #fbbf24, #f59e0b); }
    .score.poor { background: linear-gradient(135deg, #f87171, #ef4444); }
    .spinner { width:48px; height:48px; border:4px solid #e5e7eb; border-top-color: var(--brand); border-radius:50%; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body class="min-h-screen p-6">
  <div class="max-w-[1200px] mx-auto space-y-6">
    <!-- Header -->
    <header class="text-center text-white">
      <h1 class="text-3xl font-bold drop-shadow-sm">ü§ñ AI-Powered Job Match Portal</h1>
      <p class="opacity-90">Real AI analysis of job descriptions against your profile</p>
      <div class="mt-2 inline-flex items-center gap-2 badge bg-emerald-500 text-white">Live AI Enabled</div>
    </header>

    <!-- Profile & controls -->
    <section class="card">
      <h2 class="text-lg font-semibold text-slate-800 mb-3">üìã Your Resume Profile</h2>
      <div class="grid md:grid-cols-4 gap-3">
        <input id="exp" class="rounded-lg border border-slate-200 px-3 py-2" value="10+ years Education Leadership" />
        <input id="role" class="rounded-lg border border-slate-200 px-3 py-2" value="Service Projects Coordinator" />
        <input id="expertise" class="rounded-lg border border-slate-200 px-3 py-2" value="Preschool Administration" />
        <input id="edu" class="rounded-lg border border-slate-200 px-3 py-2" value="M.S. Industrial Psychology" />
      </div>

      <div class="mt-6 grid md:grid-cols-4 gap-3">
        <div>
          <label class="text-sm font-semibold text-slate-700">Location</label>
          <input id="location" class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2" value="Knightdale, NC" />
        </div>
        <div>
          <label class="text-sm font-semibold text-slate-700">Radius</label>
          <select id="radius" class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2">
            <option>10 miles</option>
            <option selected>25 miles</option>
            <option>50 miles</option>
            <option>100 miles</option>
          </select>
        </div>
        <div>
          <label class="text-sm font-semibold text-slate-700">Minimum Match</label>
          <select id="matchThreshold" class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2">
            <option value="0">Show All</option>
            <option value="60">60%+</option>
            <option value="70" selected>70%+</option>
            <option value="80">80%+</option>
          </select>
        </div>
      </div>

      <div class="mt-6">
        <h3 class="text-sm font-semibold text-slate-700 mb-2">Job Categories</h3>
        <div id="chips" class="flex flex-wrap gap-2">
          <button class="chip active" data-category="preschool-director">Preschool Director</button>
          <button class="chip active" data-category="assistant-director">Assistant Director</button>
          <button class="chip active" data-category="education-administrator">Education Administrator</button>
          <button class="chip active" data-category="curriculum-coordinator">Curriculum Coordinator</button>
          <button class="chip active" data-category="childcare-director">Childcare Center Director</button>
          <button class="chip" data-category="program-manager">Program Manager</button>
          <button class="chip" data-category="family-engagement">Family Engagement Specialist</button>
          <button class="chip" data-category="esl-teacher">ESL Teacher</button>
          <button class="chip" data-category="training-coordinator">Training Coordinator</button>
          <button class="chip" data-category="service-coordinator">Service Coordinator</button>
        </div>
      </div>

      <div class="mt-6 flex items-center gap-3">
        <button id="btnSearch" class="px-5 py-3 rounded-xl bg-indigo-600 text-white font-semibold hover:brightness-110 flex items-center gap-2">
          <span id="searchIcon">üîç</span>
          <span>Search & Analyze with AI</span>
        </button>
        <div id="busy" class="hidden items-center gap-3"><div class="spinner"></div><span class="text-slate-600">Working‚Ä¶</span></div>
      </div>
      <p id="err" class="mt-3 hidden text-sm text-red-600"></p>
    </section>

    <!-- Results -->
    <section id="results" class="card hidden">
      <div class="flex items-center justify-between mb-4">
        <div id="resultCount" class="text-slate-800 font-semibold">0 jobs found</div>
        <div class="flex gap-2">
          <button class="px-3 py-2 rounded-lg border" data-sort="match">Best Match</button>
          <button class="px-3 py-2 rounded-lg border" data-sort="recent">Most Recent</button>
          <button class="px-3 py-2 rounded-lg border" data-sort="salary">Highest Salary</button>
        </div>
      </div>
      <div id="grid" class="grid gap-4"></div>
      <div id="empty" class="hidden text-center text-slate-500 py-10">No matching jobs found. Try adjusting your filters.</div>
    </section>
  </div>

  <script>
    const API_KEY = "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";

    const SOURCES = [
      { name: 'Indeed', color: '#2164f3', url:'https://www.indeed.com' },
      { name: 'LinkedIn', color: '#0077b5', url:'https://www.linkedin.com/jobs' },
      { name: 'Glassdoor', color: '#0caa41', url:'https://www.glassdoor.com/Job' },
      { name: 'ZipRecruiter', color: '#4b7bec', url:'https://www.ziprecruiter.com' },
      { name: 'NAEYC', color: '#f59e0b', url:'https://careercenter.naeyc.org' }
    ];

    const SAMPLE = [
      {title:'Preschool Director', company:'Bright Horizons Early Learning', salary:'$48,000 - $68,000', category:'preschool-director', req:["Bachelor's in ECE", '5+ yrs leadership', 'NC Director Credential preferred', 'Strong communication'], desc:'Lead center ops, staff, compliance, quality standards.', postedDays: r(1,14), url:'https://www.indeed.com/q-preschool-director-jobs.html'},
      {title:'Assistant Director - Early Learning Center', company:'KinderCare Education', salary:'$42,000 - $58,000', category:'assistant-director', req:['Associate min, BA preferred', '3+ yrs childcare', 'Staff supervision', 'Licensing knowledge'], desc:'Assist director, supervise teachers, manage enrollment and families.', postedDays: r(1,14), url:'https://www.indeed.com/q-assistant-director-jobs.html'},
      {title:'Education Program Administrator', company:'Wake County Public Schools', salary:'$52,000 - $72,000', category:'education-administrator', req:['Masters in Education', '7+ yrs leadership', 'Budget experience', 'Regulations knowledge'], desc:'Oversee programs, budgets, outcomes, compliance.', postedDays: r(1,14), url:'https://www.linkedin.com/jobs'},
      {title:'Childcare Center Director', company:'Primrose Schools', salary:'$45,000 - $65,000', category:'preschool-director', req:['Bachelor required', '5+ yrs childcare mgmt', 'Business acumen', 'Parent comms'], desc:'Direct operations, staff development, parent relations.', postedDays: r(1,14), url:'https://www.glassdoor.com/Job'},
      {title:'Curriculum Development Specialist', company:'Durham Public Schools', salary:'$50,000 - $70,000', category:'curriculum-coordinator', req:['Masters in C&I', 'Teaching exp', 'Standards knowledge', 'PD experience'], desc:'Design curriculum, train teachers, align to standards.', postedDays: r(1,14), url:'https://www.ziprecruiter.com'},
      {title:'Early Childhood Education Coordinator', company:'YMCA of the Triangle', salary:'$40,000 - $56,000', category:'program-manager', req:['BA in ECE', '3+ yrs coordination', 'Org skills', 'Community partnerships'], desc:'Coordinate programs, partners, scheduling, impact.', postedDays: r(1,14), url:'https://careercenter.naeyc.org'}
    ];

    function r(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }

    function getProfile(){
      return {
        exp: document.getElementById('exp').value,
        role: document.getElementById('role').value,
        expertise: document.getElementById('expertise').value,
        edu: document.getElementById('edu').value
      };
    }

    document.getElementById('chips').addEventListener('click', (e)=>{
      if(e.target.classList.contains('chip')) e.target.classList.toggle('active');
    });

    document.getElementById('btnSearch').addEventListener('click', async ()=>{
      const active = [...document.querySelectorAll('.chip.active')].map(x=>x.dataset.category);
      if (active.length===0) return showErr('Select at least one job category.');

      hideErr();
      const btn = document.getElementById('btnSearch');
      const busy = document.getElementById('busy');
      btn.disabled = true; busy.classList.remove('hidden');

      try {
        const jobs = SAMPLE.filter(j=>active.includes(j.category)).map(j=>withSource(j));
        const analyzed = [];
        for (const job of jobs){
          const analysis = await aiAnalyzeJob(API_KEY, "gpt-4o-mini", getProfile(), job);
          analyzed.push({...job, analysis});
        }
        const min = parseInt(document.getElementById('matchThreshold').value,10);
        const finalJobs = analyzed.filter(j=>j.analysis.score>=min).sort((a,b)=>b.analysis.score-a.analysis.score);
        renderResults(finalJobs);
      } catch(err){
        showErr('AI analysis failed.');
        console.error(err);
      } finally {
        btn.disabled = false; busy.classList.add('hidden');
      }
    });

    function withSource(job){
      const s = SOURCES[Math.floor(Math.random()*SOURCES.length)];
      return { ...job, source: s, location: ['Raleigh','Durham','Cary','Chapel Hill','Wake Forest'][Math.floor(Math.random()*5)], type:'Full-time', tags:['Leadership','Education','Management','Early Childhood'] };
    }

    async function aiAnalyzeJob(key, model, profile, job){
      const sys = `You are an expert career coach. Score job fit 0-100 and list strengths, gaps, and a 1-2 sentence recommendation. Return strict JSON with keys: score, strengths, gaps, insight, recommendation.`;
      const user = `Candidate profile:\n- Experience: ${profile.exp}\n- Current role: ${profile.role}\n- Expertise: ${profile.expertise}\n- Education: ${profile.edu}\n\nJob:\n- Title: ${job.title}\n- Company: ${job.company}\n- Location: ${job.location}, NC\n- Salary: ${job.salary}\n- Requirements: ${job.req.join('; ')}\n- Description: ${job.desc}`;

      const res = await fetch('https://api.openai.com/v1/chat/completions',{
        method:'POST',
        headers:{ 'Content-Type':'application/json', 'Authorization':`Bearer ${key}` },
        body: JSON.stringify({ model, temperature: 0.2, messages:[{role:'system', content: sys},{role:'user', content: user}], response_format: { type: 'json_object' } })
      });

      if(!res.ok){ throw new Error(await res.text()); }
      const data = await res.json();
      const content = data.choices?.[0]?.message?.content || '{}';
      try { return JSON.parse(content); } catch { return {score:75, strengths:["Leadership"], gaps:["Budget"], insight:"Default", recommendation:"Default"}; }
    }

    function renderResults(items){
      const results = document.getElementById('results');
      const grid = document.getElementById('grid');
      const empty = document.getElementById('empty');
      const count = document.getElementById('resultCount');
      results.classList.remove('hidden');
      grid.innerHTML='';
      empty.classList.add('hidden');

      if(!items.length){ empty.classList.remove('hidden'); count.textContent='0 jobs found'; return; }

      count.textContent = `${items.length} job${items.length!==1?'s':''} found`;
      items.forEach(job=> grid.appendChild(jobCard(job)) );
    }

    function jobCard(job){
      const el = document.createElement('div');
      el.className = 'relative card';
      el.dataset.score = job.analysis.score;
      el.innerHTML = `
        <div class="score">${job.analysis.score}%</div>
        <div class="pr-20">
          <h3 class="text-lg font-semibold text-slate-800">${job.title}</h3>
          <div class="text-slate-600">${job.company} <span class="badge text-white ml-2" style="background:${job.source.color}">${job.source.name}</span></div>
        </div>
        <div
